<app-header></app-header>

<div class="controls">
    <button type="button" (click)="loadImages(0)" [disabled]="isLoading">
        <i class="fas fa-refresh"></i> Refresh
    </button>
    <button type="button" (click)="clearSelection()" [disabled]="!selectedImage">
        <i class="fas fa-times"></i> Clear Selection
    </button>
</div>

<div class="master-detail-container">
    <!-- Left Side: Image List -->
    <div class="image-list-panel">
        <div *ngIf="images.length > 0" class="image-list">
            <h2>Available Images ({{ pagination.total }} total)</h2>

            <div class="search-controls">
                <input type="text"
                       placeholder="Search prompts..."
                       class="search-input"
                       [value]="searchTerm"
                       (input)="onSearchChange($any($event.target).value)"
                       [disabled]="isLoading">
                <small class="search-hint">Search & sort: current page only</small>
            </div>

            <table class="result-table">
                <thead>
                <tr>
                    <th class="prompt-col">Prompt</th>
                    <th class="sortable-header" (click)="toggleSort()">
                        Created
                        <i class="fas" [class.fa-sort-down]="sortDirection === 'desc'"
                           [class.fa-sort-up]="sortDirection === 'asc'"></i>
                    </th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let image of filteredImages"
                    [class.selected]="selectedImage?.id === image.id">
                    <td class="prompt-col">{{ image.prompt | displayName }}</td>
                    <td>{{ formatDateShort(image.created_at) }}</td>
                    <td>
                        <button type="button"
                                (click)="selectImage(image)"
                                [disabled]="isLoading"
                                [class.active]="selectedImage?.id === image.id">
                            <i class="fas fa-eye"></i>
                            {{ selectedImage?.id === image.id ? 'Selected' : 'View' }}
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination-controls">
                <button type="button"
                        (click)="previousPage()"
                        [disabled]="currentPage === 0 || isLoading">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <span class="pagination-info">
                    Page {{ currentPage + 1 }} of {{ Math.ceil(pagination.total / pagination.limit) }}
                    ({{ pagination.total }} images total)
                </span>
                <button type="button"
                        (click)="nextPage()"
                        [disabled]="!pagination.has_more || isLoading">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <div *ngIf="!images.length && !isLoading" class="no-images-message">
            <p>No images found in the database.</p>
        </div>

        <div *ngIf="isLoading" class="loading-message">
            <i class="fas fa-spinner fa-spin"></i> Loading images...
        </div>
    </div>

    <!-- Right Side: Image Details -->
    <div class="image-details-panel">
        <div *ngIf="!selectedImage && !isLoading" class="no-selection">
            <div class="placeholder-content">
                <i class="fas fa-image placeholder-icon"></i>
                <p>Select an image from the list to view details</p>
            </div>
        </div>

        <!-- Image Details Content -->
        <div *ngIf="selectedImage" class="image-details-section">
            <h2>Image Details</h2>

            <div class="image-info-compact">
                <div class="image-meta-info">
                    <p><strong>Model:</strong> {{ selectedImage.model_used }}</p>
                    <p><strong>Size:</strong> {{ selectedImage.size }}</p>
                    <p><strong>Created:</strong> {{ formatDate(selectedImage.created_at) }}</p>
                </div>

                <div class="image-prompt">
                    <h3>Prompt:</h3>
                    <p class="prompt-content">{{ selectedImage.prompt }}</p>
                </div>
            </div>

            <div class="image-actions">
                <a [href]="selectedImage.url" target="_blank" class="download-link">
                    <i class="fas fa-download"></i> Download Original
                </a>
            </div>

            <div class="image-display">
                <img [src]="selectedImage.url"
                     [alt]="selectedImage.prompt | displayName"
                     (error)="onImageError($event)"
                     loading="lazy">
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>
