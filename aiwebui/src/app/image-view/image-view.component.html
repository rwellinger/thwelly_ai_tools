<h1>DALL.E 3 - Picture Viewer</h1>
<app-header></app-header>

<div class="controls">
  <button type="button" (click)="loadImages(0)" [disabled]="isLoading">
    <i class="fas fa-refresh"></i> Refresh
  </button>
  <button type="button" (click)="clearSelection()" [disabled]="!selectedImage">
    <i class="fas fa-times"></i> Clear Selection
  </button>
</div>

<div *ngIf="isLoading" class="loading">{{ loadingMessage }}</div>

<div class="image-list" *ngIf="images.length > 0">
  <h2>Available Images ({{ pagination.total }} total)</h2>

  <table class="result-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Model</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let image of images"
          [class.selected]="selectedImage?.id === image.id">
        <td>{{ image.displayName }}</td>
        <td>{{ image.model_used }}</td>
        <td>{{ formatDate(image.created_at) }}</td>
        <td>
          <button type="button"
                  (click)="selectImage(image)"
                  [disabled]="isLoading"
                  [class.active]="selectedImage?.id === image.id">
            <i class="fas fa-eye"></i>
            {{ selectedImage?.id === image.id ? 'Selected' : 'View' }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination-controls">
    <button type="button"
            (click)="previousPage()"
            [disabled]="currentPage === 0 || isLoading">
      <i class="fas fa-arrow-left"></i> Previous
    </button>

    <span class="page-info">
      Page {{ currentPage + 1 }}
      ({{ pagination.offset + 1 }}-{{ Math.min(pagination.offset + pagination.limit, pagination.total) }}
      of {{ pagination.total }} images)
    </span>

    <button type="button"
            (click)="nextPage()"
            [disabled]="!pagination.has_more || isLoading">
      <i class="fas fa-arrow-right"></i> Next
    </button>
  </div>
</div>

<div *ngIf="!images.length && !isLoading" class="no-images">
  No images found. Try refreshing the list.
</div>

<div *ngIf="selectedImage" class="image-detail">
  <h2>Image Detail</h2>

  <div class="detail-container">
    <div class="detail-info">
      <div class="info-box">
        <p><strong>ID:</strong> {{ selectedImage.id }}</p>
        <p><strong>Name:</strong> {{ selectedImage.displayName }}</p>
        <p><strong>Model used:</strong> {{ selectedImage.model_used }}</p>
        <p><strong>Created:</strong> {{ formatDate(selectedImage.created_at) }}</p>
        <p><strong>Size:</strong> {{ selectedImage.size }}</p>
        <p><strong>Filename:</strong> {{ selectedImage.filename }}</p>
        <p><strong>Prompt:</strong> {{ selectedImage.prompt }}</p>
      </div>

      <div class="image-actions">
        <a [href]="selectedImage.url" target="_blank" class="download-link">
          <i class="fas fa-download"></i> Download Original
        </a>
      </div>
    </div>

    <div class="image-display">
      <img [src]="selectedImage.url"
           [alt]="selectedImage.displayName"
           (error)="onImageError($event)"
           loading="lazy">
    </div>
  </div>
</div>

<app-footer></app-footer>
