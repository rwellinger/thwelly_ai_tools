<div class="password-change-panel">
  <div class="panel-header">
    <h2>
      <i class="fas fa-key panel-icon"></i>
      Change Password
    </h2>
  </div>

  <div class="panel-content">
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
      <!-- Current Password Section -->
      <div class="form-section">
        <div class="section-label">
          <i class="fas fa-lock meta-icon"></i>
          <span>Current Password</span>
        </div>
        <div class="input-group">
          <input
            type="password"
            [type]="showOldPassword ? 'text' : 'password'"
            formControlName="oldPassword"
            class="form-input"
            placeholder="Enter your current password"
            autocomplete="current-password">
          <button
            type="button"
            class="toggle-btn"
            (click)="togglePasswordVisibility('old')"
            [attr.aria-label]="showOldPassword ? 'Hide password' : 'Show password'">
            <i class="fas" [class.fa-eye]="!showOldPassword" [class.fa-eye-slash]="showOldPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="hasFieldError('oldPassword')">
          <i class="fas fa-exclamation-circle"></i>
          {{ getErrorMessage('oldPassword') }}
        </div>
      </div>

      <!-- New Password Section -->
      <div class="form-section">
        <div class="section-label">
          <i class="fas fa-key meta-icon"></i>
          <span>New Password</span>
        </div>
        <div class="input-group">
          <input
            type="password"
            [type]="showNewPassword ? 'text' : 'password'"
            formControlName="newPassword"
            class="form-input"
            placeholder="Enter your new password"
            autocomplete="new-password">
          <button
            type="button"
            class="toggle-btn"
            (click)="togglePasswordVisibility('new')"
            [attr.aria-label]="showNewPassword ? 'Hide password' : 'Show password'">
            <i class="fas" [class.fa-eye]="!showNewPassword" [class.fa-eye-slash]="showNewPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="hasFieldError('newPassword')">
          <i class="fas fa-exclamation-circle"></i>
          {{ getErrorMessage('newPassword') }}
        </div>
      </div>

      <!-- Confirm Password Section -->
      <div class="form-section">
        <div class="section-label">
          <i class="fas fa-check-circle meta-icon"></i>
          <span>Confirm Password</span>
        </div>
        <div class="input-group">
          <input
            type="password"
            [type]="showConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
            class="form-input"
            placeholder="Repeat your new password"
            autocomplete="new-password">
          <button
            type="button"
            class="toggle-btn"
            (click)="togglePasswordVisibility('confirm')"
            [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'">
            <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="hasFieldError('confirmPassword') || passwordForm.hasError('passwordMismatch')">
          <i class="fas fa-exclamation-circle"></i>
          {{ getErrorMessage('confirmPassword') }}
        </div>
      </div>

      <!-- Password Requirements -->
      <div class="info-section">
        <i class="fas fa-info-circle info-icon"></i>
        <span class="info-text">Password must be at least 6 characters long.</span>
      </div>
    </form>
  </div>

  <div class="panel-actions">
    <button
      type="button"
      class="action-btn cancel-btn"
      (click)="onCancel()"
      [disabled]="isLoading">
      <i class="fas fa-times"></i>
      Cancel
    </button>

    <button
      type="button"
      class="action-btn primary-btn"
      (click)="onSubmit()"
      [disabled]="passwordForm.invalid || isLoading">
      <span *ngIf="isLoading">
        <i class="fas fa-spinner fa-spin"></i>
        Changing...
      </span>
      <span *ngIf="!isLoading">
        <i class="fas fa-save"></i>
        Change Password
      </span>
    </button>
  </div>
</div>