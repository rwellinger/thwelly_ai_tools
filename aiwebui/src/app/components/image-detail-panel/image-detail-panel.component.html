<div class="image-details-panel">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-section">
        <div class="placeholder-content">
            <i class="fas fa-spinner fa-spin placeholder-icon"></i>
            <p>Loading image details...</p>
        </div>
    </div>

    <!-- Error State -->
    <div *ngIf="loadingError && !isLoading" class="error-section">
        <div class="placeholder-content">
            <i class="fas fa-exclamation-triangle placeholder-icon error-icon"></i>
            <p>{{ loadingError }}</p>
        </div>
    </div>

    <!-- No Selection State -->
    <div *ngIf="!image && !isLoading && !loadingError" class="no-selection">
        <div class="placeholder-content">
            <i [class]="placeholderIcon + ' placeholder-icon'"></i>
            <p>{{ placeholderText }}</p>
        </div>
    </div>

    <!-- Image Details Content -->
    <div *ngIf="image" class="image-details-section">
        <h2>{{ title }}</h2>

        <div class="image-info-compact">
            <!-- Editable Title Section -->
            <div class="image-title-section" *ngIf="showEditTitle">
                <div class="title-row" *ngIf="!editingTitle">
                    <h3 class="image-title">{{ getDisplayTitle(image) }}</h3>
                    <button type="button" class="edit-btn" (click)="startEditTitle()">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                <div class="title-edit-row" *ngIf="editingTitle">
                    <input type="text"
                           class="title-input"
                           [(ngModel)]="editTitleValue"
                           (keyup.enter)="saveTitle()"
                           (keyup.escape)="cancelEditTitle()"
                           #titleInput>
                    <button type="button" class="save-btn" (click)="saveTitle()">
                        <i class="fas fa-check"></i>
                    </button>
                    <button type="button" class="cancel-btn" (click)="cancelEditTitle()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="image-meta-info">
                <div class="meta-grid">
                    <div class="meta-item" *ngIf="shouldShowMetaInfo('model') && image.model_used">
                        <i class="fas fa-robot meta-icon"></i>
                        <span class="meta-value">{{ image.model_used }}</span>
                    </div>
                    <div class="meta-item" *ngIf="shouldShowMetaInfo('size') && image.size">
                        <i class="fas fa-expand-arrows-alt meta-icon"></i>
                        <span class="meta-value">{{ image.size }}</span>
                    </div>
                    <div class="meta-item" *ngIf="shouldShowMetaInfo('created') && image.created_at">
                        <i class="fas fa-calendar meta-icon"></i>
                        <span class="meta-value">{{ formatDate(image.created_at) }}</span>
                    </div>
                </div>
            </div>

            <div class="image-prompt" *ngIf="image.prompt">
                <h3>Prompt:</h3>
                <p class="prompt-content">{{ image.prompt }}</p>
            </div>

            <div class="image-display">
                <div class="responsive-image-container" [ngClass]="getImageSizeClass()">
                    <img [src]="imageBlobUrl"
                         [alt]="image.prompt || 'Generated Picture'"
                         (error)="onImageError($event)"
                         loading="lazy"
                         class="responsive-image">
                </div>
            </div>
        </div>

        <!-- Action Buttons Area -->
        <div class="detail-actions" *ngIf="showActionButtons">
            <div class="action-buttons">
                <button type="button" (click)="onDownloadOriginal()" class="action-btn download-btn">
                    <i class="fas fa-download"></i>
                    <span>Download Original</span>
                </button>
                <button type="button" (click)="onPreview()" class="action-btn preview-btn">
                    <i class="fas fa-expand"></i>
                    <span>Full Size</span>
                </button>
            </div>
    </div>
</div>
