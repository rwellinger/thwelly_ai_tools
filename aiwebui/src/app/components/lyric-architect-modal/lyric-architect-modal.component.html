<div class="lyric-architect-modal">
  <h2 mat-dialog-title>
    <i class="fas fa-layer-group"></i>
    Lyric Architecture
  </h2>

  <mat-dialog-content class="dialog-content">
    <div class="architecture-container">

      <!-- Left Side: Song Structure -->
      <div class="song-structure-panel">
        <h3>
          <i class="fas fa-list"></i>
          Song Structure
        </h3>

        <div class="structure-preview" *ngIf="config.sections.length > 0">
          <small class="preview-label">Preview:</small>
          <div class="preview-text">{{ getPreviewText() }}</div>
        </div>

        <div
          class="song-structure-list"
          cdkDropList
          #songList="cdkDropList"
          [cdkDropListData]="config.sections"
          [cdkDropListConnectedTo]="[availableList]"
          (cdkDropListDropped)="onSectionDrop($event)">

          <div
            *ngFor="let item of config.sections; trackBy: trackBySectionId"
            class="section-item"
            cdkDrag>

            <div class="section-content">
              <div class="drag-handle" cdkDragHandle>
                <i class="fas fa-grip-vertical"></i>
              </div>

              <div class="section-info">
                <div class="section-name">{{ item.displayName }}</div>
                <div class="section-description">
                  {{ getSectionDescription(item.section) }}
                </div>
              </div>

              <button
                type="button"
                class="remove-btn"
                (click)="removeSection(item.id)"
                title="Remove section">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <div *ngIf="config.sections.length === 0" class="empty-structure">
            <i class="fas fa-arrow-left"></i>
            <p>Drag sections here to build your song structure</p>
          </div>
        </div>
      </div>

      <!-- Right Side: Available Sections -->
      <div class="available-sections-panel">
        <h3>
          <i class="fas fa-puzzle-piece"></i>
          Available Sections
        </h3>

        <div
          class="available-sections-list"
          cdkDropList
          #availableList="cdkDropList"
          [cdkDropListData]="availableSections"
          [cdkDropListConnectedTo]="[songList]"
          [cdkDropListEnterPredicate]="noReturnPredicate"
          (cdkDropListDropped)="onAvailableSectionDrop($event)">

          <div
            *ngFor="let sectionDef of availableSections"
            class="available-section-item"
            [class.disabled]="!canAddSection(sectionDef.section)"
            cdkDrag
            [cdkDragDisabled]="!canAddSection(sectionDef.section)">

            <div class="section-content">
              <div class="section-icon">
                <i class="fas" [class]="sectionDef.icon"></i>
              </div>

              <div class="section-info">
                <div class="section-name">{{ sectionDef.displayName }}</div>
                <div class="section-description">{{ sectionDef.description }}</div>
                <div class="section-usage" *ngIf="!sectionDef.allowMultiple && getSectionCount(sectionDef.section) > 0">
                  Already added
                </div>
                <div class="section-usage" *ngIf="sectionDef.allowMultiple && getSectionCount(sectionDef.section) > 0">
                  Used {{ getSectionCount(sectionDef.section) }} time{{ getSectionCount(sectionDef.section) > 1 ? 's' : '' }}
                </div>
              </div>

              <div class="add-btn" *ngIf="canAddSection(sectionDef.section)">
                <i class="fas fa-plus"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <div class="dialog-actions">
      <button
        type="button"
        mat-button
        class="reset-btn"
        (click)="reset()">
        <i class="fas fa-undo"></i>
        Reset
      </button>

      <div class="action-buttons">
        <button
          type="button"
          mat-button
          (click)="cancel()">
          Cancel
        </button>

        <button
          type="button"
          mat-raised-button
          color="primary"
          (click)="save()">
          <i class="fas fa-save"></i>
          Apply Architecture
        </button>
      </div>
    </div>
  </mat-dialog-actions>
</div>